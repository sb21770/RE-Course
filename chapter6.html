<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 6: Assembly - Flow Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131a2b;
            --bg-card: #1a2235;
            --accent-primary: #00ff88;
            --accent-secondary: #00b4d8;
            --accent-warning: #ff6b35;
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0a0;
            --border-color: #2a3548;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.9; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        nav { background: var(--bg-secondary); padding: 1rem 2rem; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 100; }
        nav a { color: var(--accent-primary); text-decoration: none; }
        .chapter-header { background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%); padding: 4rem 2rem; text-align: center; border-bottom: 1px solid var(--border-color); }
        .chapter-number { display: inline-block; background: linear-gradient(135deg, #00ff88 0%, #00b4d8 100%); color: var(--bg-primary); padding: 0.5rem 1.5rem; border-radius: 30px; font-weight: 700; margin-bottom: 1rem; }
        h1 { font-size: 2.5rem; margin-bottom: 1rem; background: linear-gradient(135deg, #00ff88 0%, #00b4d8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { color: var(--text-secondary); font-size: 1.1rem; }
        .content { padding: 3rem 0; }
        h2 { font-size: 1.8rem; color: var(--accent-primary); margin: 3rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border-color); }
        h3 { font-size: 1.3rem; color: var(--accent-secondary); margin: 2rem 0 1rem; }
        p { margin-bottom: 1.5rem; }
        .definition { background: var(--bg-card); border-left: 4px solid var(--accent-primary); padding: 1.5rem; border-radius: 0 10px 10px 0; margin: 1.5rem 0; }
        .definition-title { color: var(--accent-primary); font-weight: 700; font-size: 1.1rem; margin-bottom: 0.5rem; }
        .info-box { background: rgba(0, 180, 216, 0.1); border: 1px solid var(--accent-secondary); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
        .info-box-title { color: var(--accent-secondary); font-weight: 700; margin-bottom: 0.5rem; }
        .warning-box { background: rgba(255, 107, 53, 0.1); border: 1px solid var(--accent-warning); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
        .warning-box-title { color: var(--accent-warning); font-weight: 700; margin-bottom: 0.5rem; }
        ul, ol { margin: 1rem 0 1.5rem 1.5rem; }
        li { margin-bottom: 0.8rem; }
        code { font-family: 'Fira Code', monospace; background: var(--bg-card); padding: 0.2rem 0.5rem; border-radius: 4px; color: var(--accent-primary); font-size: 0.9rem; }
        pre { font-family: 'Fira Code', monospace; background: var(--bg-card); padding: 1.5rem; border-radius: 10px; overflow-x: auto; margin: 0; border: 1px solid var(--border-color); line-height: 1.6; }
        .code-block { margin: 1.5rem 0; }
        .code-label { color: var(--accent-secondary); font-weight: 700; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .diagram { background: var(--bg-card); border-radius: 15px; padding: 2rem; margin: 2rem 0; text-align: center; border: 1px solid var(--border-color); }
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; background: var(--bg-card); border-radius: 10px; overflow: hidden; }
        th, td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color); }
        th { background: var(--bg-secondary); color: var(--accent-primary); font-weight: 600; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color); }
        .nav-btn { background: var(--bg-card); color: var(--text-primary); padding: 1rem 2rem; border-radius: 10px; text-decoration: none; border: 1px solid var(--border-color); transition: all 0.3s; }
        .nav-btn:hover { border-color: var(--accent-primary); transform: translateY(-3px); }
        .instruction { background: var(--bg-secondary); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid var(--accent-secondary); }
        .instruction-name { color: var(--accent-secondary); font-family: 'Fira Code', monospace; font-size: 1.2rem; font-weight: 700; margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">‚Üê Back to Main Menu</a>
    </nav>

    <header class="chapter-header">
        <div class="chapter-number">Chapter 6</div>
        <h1>Assembly - Flow Control</h1>
        <p class="subtitle">Jumps, conditions, loops, and function calls</p>
    </header>

    <div class="container">
        <div class="content">
            
            <h2>üîÄ Jumps</h2>

            <div class="definition">
                <div class="definition-title">üìñ Definition: Jump</div>
                <p>An instruction that changes EIP (the next instruction pointer) - causes the code to "jump" to another location.</p>
            </div>

            <div class="instruction">
                <div class="instruction-name">JMP</div>
                <p>Unconditional jump - always jumps.</p>
            </div>

            <div class="code-block">
                <pre>JMP label       ; Jump to label (symbolic name)
JMP 0x00401050  ; Jump to specific address
JMP EAX         ; Jump to address stored in EAX register</pre>
            </div>

            <h2>‚öñÔ∏è Comparison and Flag Effects</h2>

            <div class="instruction">
                <div class="instruction-name">CMP</div>
                <p><strong>Compare</strong> - compares two values (subtracts without saving the result).<br>
                Updates flags based on the result.</p>
            </div>

            <div class="code-block">
                <pre>CMP EAX, EBX    ; Compare EAX to EBX (subtract without saving)
                ; If EAX == EBX: ZF = 1
                ; If EAX < EBX:  CF = 1 (unsigned), SF != OF (signed)
                ; If EAX > EBX:  CF = 0 and ZF = 0</pre>
            </div>

            <div class="instruction">
                <div class="instruction-name">TEST</div>
                <p>Does AND without saving result. Used to check if a value is 0.</p>
            </div>

            <div class="code-block">
                <pre>TEST EAX, EAX   ; Check if EAX equals 0
                ; If EAX == 0: ZF = 1
                ; If EAX != 0: ZF = 0</pre>
            </div>

            <h2>üö¶ Conditional Jumps</h2>

            <p>Jump only if a certain condition is met (usually after CMP or TEST):</p>

            <table>
                <tr>
                    <th>Instruction</th>
                    <th>Meaning</th>
                    <th>Condition</th>
                </tr>
                <tr>
                    <td><code>JE / JZ</code></td>
                    <td>Jump if Equal / Zero</td>
                    <td>ZF = 1</td>
                </tr>
                <tr>
                    <td><code>JNE / JNZ</code></td>
                    <td>Jump if Not Equal / Not Zero</td>
                    <td>ZF = 0</td>
                </tr>
                <tr>
                    <td><code>JG / JNLE</code></td>
                    <td>Jump if Greater (signed)</td>
                    <td>ZF=0 AND SF=OF</td>
                </tr>
                <tr>
                    <td><code>JGE / JNL</code></td>
                    <td>Jump if Greater or Equal (signed)</td>
                    <td>SF = OF</td>
                </tr>
                <tr>
                    <td><code>JL / JNGE</code></td>
                    <td>Jump if Less (signed)</td>
                    <td>SF ‚â† OF</td>
                </tr>
                <tr>
                    <td><code>JLE / JNG</code></td>
                    <td>Jump if Less or Equal (signed)</td>
                    <td>ZF=1 OR SF‚â†OF</td>
                </tr>
                <tr>
                    <td><code>JA / JNBE</code></td>
                    <td>Jump if Above (unsigned)</td>
                    <td>CF=0 AND ZF=0</td>
                </tr>
                <tr>
                    <td><code>JAE / JNB</code></td>
                    <td>Jump if Above or Equal (unsigned)</td>
                    <td>CF = 0</td>
                </tr>
                <tr>
                    <td><code>JB / JNAE</code></td>
                    <td>Jump if Below (unsigned)</td>
                    <td>CF = 1</td>
                </tr>
                <tr>
                    <td><code>JBE / JNA</code></td>
                    <td>Jump if Below or Equal (unsigned)</td>
                    <td>CF=1 OR ZF=1</td>
                </tr>
            </table>

            <div class="info-box">
                <div class="info-box-title">üí° Signed vs Unsigned - What's the Difference?</div>
                <p>
                    <strong>Signed</strong> = numbers that can be <strong>positive or negative</strong> (-128 ... -1, 0, 1 ... 127)<br>
                    <strong>Unsigned</strong> = numbers that can be <strong>only positive</strong> (0, 1, 2 ... 255)
                </p>
                <table style="margin: 1rem 0; font-size: 0.9rem;">
                    <tr>
                        <th>Type</th>
                        <th>Jump Instructions</th>
                        <th>Memory Trick</th>
                    </tr>
                    <tr>
                        <td><strong>Signed</strong> (pos/neg)</td>
                        <td><code>JG, JGE, JL, JLE</code></td>
                        <td><strong>G</strong>reater / <strong>L</strong>ess</td>
                    </tr>
                    <tr>
                        <td><strong>Unsigned</strong> (only pos)</td>
                        <td><code>JA, JAE, JB, JBE</code></td>
                        <td><strong>A</strong>bove / <strong>B</strong>elow</td>
                    </tr>
                </table>
            </div>
            
            <div class="warning-box">
                <div class="warning-box-title">‚ö†Ô∏è Why does this matter?</div>
                <p>The same bits can be interpreted differently:</p>
                <pre style="background: transparent; padding: 0; border: none; margin: 0.5rem 0;">
0xFFFFFFFF:
  As Unsigned = 4,294,967,295 (biggest number!)
  As Signed   = -1
                </pre>
                <p style="margin-bottom: 0;">
                    If comparing <code>0xFFFFFFFF</code> to <code>1</code>:<br>
                    ‚Ä¢ <code>JA</code> (unsigned) ‚Üí will jump! (4 billion > 1)<br>
                    ‚Ä¢ <code>JG</code> (signed) ‚Üí won't jump! (-1 < 1)
                </p>
            </div>

            <h2>üìù Example: if-else Condition</h2>

            <div class="code-block">
                <div class="code-label">C code:</div>
                <pre>if (a == 5) {
    b = 10;
} else {
    b = 20;
}</pre>
            </div>

            <div class="code-block">
                <div class="code-label">Assembly:</div>
                <pre>    mov eax, [ebp-4]        ; Load 'a' into EAX
    cmp eax, 5              ; Compare a to 5
    jne else_branch         ; If not equal, jump to else

    ; IF BLOCK (a == 5)
    mov dword [ebp-8], 10   ; b = 10
    jmp end_if              ; Skip else block

else_branch:
    ; ELSE BLOCK (a != 5)
    mov dword [ebp-8], 20   ; b = 20

end_if:
    ; Continue...</pre>
            </div>

            <div class="diagram">
                <svg viewBox="0 0 400 280" xmlns="http://www.w3.org/2000/svg">
                    <!-- CMP box -->
                    <rect x="150" y="10" width="100" height="40" rx="5" fill="#1a2235" stroke="#00b4d8" stroke-width="2"/>
                    <text x="200" y="35" text-anchor="middle" fill="#00b4d8" font-size="12" font-family="Fira Code">CMP a, 5</text>
                    
                    <!-- Diamond (condition) -->
                    <polygon points="200,70 260,100 200,130 140,100" fill="#1a2235" stroke="#00ff88" stroke-width="2"/>
                    <text x="200" y="105" text-anchor="middle" fill="#00ff88" font-size="11">a == 5?</text>
                    
                    <!-- Arrow down from CMP -->
                    <line x1="200" y1="50" x2="200" y2="70" stroke="#a0a0a0" stroke-width="2"/>
                    
                    <!-- Yes branch (left) -->
                    <line x1="140" y1="100" x2="80" y2="100" stroke="#00ff88" stroke-width="2"/>
                    <line x1="80" y1="100" x2="80" y2="160" stroke="#00ff88" stroke-width="2"/>
                    <text x="110" y="90" fill="#00ff88" font-size="10">Yes</text>
                    
                    <rect x="30" y="160" width="100" height="40" rx="5" fill="#1a2235" stroke="#00ff88" stroke-width="2"/>
                    <text x="80" y="185" text-anchor="middle" fill="#00ff88" font-size="11" font-family="Fira Code">b = 10</text>
                    
                    <!-- No branch (right) -->
                    <line x1="260" y1="100" x2="320" y2="100" stroke="#ff6b35" stroke-width="2"/>
                    <line x1="320" y1="100" x2="320" y2="160" stroke="#ff6b35" stroke-width="2"/>
                    <text x="290" y="90" fill="#ff6b35" font-size="10">No (JNE)</text>
                    
                    <rect x="270" y="160" width="100" height="40" rx="5" fill="#1a2235" stroke="#ff6b35" stroke-width="2"/>
                    <text x="320" y="185" text-anchor="middle" fill="#ff6b35" font-size="11" font-family="Fira Code">b = 20</text>
                    
                    <!-- Merge -->
                    <line x1="80" y1="200" x2="80" y2="240" stroke="#a0a0a0" stroke-width="2"/>
                    <line x1="320" y1="200" x2="320" y2="240" stroke="#a0a0a0" stroke-width="2"/>
                    <line x1="80" y1="240" x2="320" y2="240" stroke="#a0a0a0" stroke-width="2"/>
                    <line x1="200" y1="240" x2="200" y2="260" stroke="#a0a0a0" stroke-width="2"/>
                    
                    <text x="200" y="275" text-anchor="middle" fill="#a0a0a0" font-size="10">Continue</text>
                </svg>
            </div>

            <h2>üîÑ Loops</h2>

            <h3>while Loop</h3>

            <div class="code-block">
                <div class="code-label">C code:</div>
                <pre>while (i < 10) {
    sum += i;
    i++;
}</pre>
            </div>

            <div class="code-block">
                <div class="code-label">Assembly:</div>
                <pre>loop_start:
    cmp dword [ebp-4], 10   ; Check: is i < 10?
    jge loop_end            ; If i >= 10, exit loop

    ; LOOP BODY
    mov eax, [ebp-4]        ; EAX = i
    add [ebp-8], eax        ; sum += i
    inc dword [ebp-4]       ; i++

    jmp loop_start          ; Jump back to start

loop_end:</pre>
            </div>

            <h3>for Loop with LOOP</h3>

            <div class="instruction">
                <div class="instruction-name">LOOP</div>
                <p>Decreases ECX by 1 and jumps if ECX ‚â† 0. Useful for loops!</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">üí° Understanding the LOOP example</div>
                <pre style="background: transparent; padding: 0; border: none; margin: 0;">
    mov ecx, 10         ; ECX = 10 (put 10 into ECX, NOT subtract!)

loop_start:             ; ‚Üê LABEL: a name/bookmark for this location
    ; loop body here    ;   (the code that repeats)

    loop loop_start     ; Does TWO things automatically:
                        ;   1. ECX = ECX - 1
                        ;   2. If ECX != 0, jump to loop_start
                </pre>
            </div>
            
            <p><strong>Step-by-step execution (with ECX = 3):</strong></p>
            <table style="font-size: 0.9rem;">
                <tr>
                    <th>Iteration</th>
                    <th>ECX before LOOP</th>
                    <th>LOOP does ECX--</th>
                    <th>ECX after</th>
                    <th>Jump?</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>3</td>
                    <td>3 - 1</td>
                    <td>2</td>
                    <td>‚úÖ Yes ‚Üí loop_start</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>2</td>
                    <td>2 - 1</td>
                    <td>1</td>
                    <td>‚úÖ Yes ‚Üí loop_start</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>1</td>
                    <td>1 - 1</td>
                    <td>0</td>
                    <td>‚ùå No ‚Üí continue</td>
                </tr>
            </table>
            <p style="margin-top: 0.5rem;"><strong>Result:</strong> The loop body runs 3 times!</p>

            <h2>üìû Function Calls</h2>

            <div class="instruction">
                <div class="instruction-name">CALL</div>
                <p>Calls a function: saves the return address on the Stack and jumps to the function.</p>
            </div>

            <div class="instruction">
                <div class="instruction-name">RET</div>
                <p>Returns from a function: takes an address from the Stack and jumps to it.</p>
            </div>

            <div class="code-block">
                <div class="code-label">Calling a function:</div>
                <pre>CALL my_function    ; = PUSH EIP (save return addr), then JMP my_function</pre>
            </div>

            <div class="code-block">
                <div class="code-label">The function itself:</div>
                <pre>my_function:
    push ebp            ; Save old EBP
    mov ebp, esp        ; Set up stack frame
    ; ... code ...
    pop ebp             ; Restore old EBP
    RET                 ; = POP EIP (get return addr and jump to it)</pre>
            </div>

            <div class="diagram">
                <svg viewBox="0 0 500 200" xmlns="http://www.w3.org/2000/svg">
                    <!-- Main function -->
                    <rect x="20" y="20" width="180" height="160" rx="10" fill="#1a2235" stroke="#00b4d8" stroke-width="2"/>
                    <text x="110" y="45" text-anchor="middle" fill="#00b4d8" font-size="12" font-weight="bold">main()</text>
                    
                    <text x="40" y="75" fill="#a0a0a0" font-size="10" font-family="Fira Code">...</text>
                    <text x="40" y="95" fill="#00ff88" font-size="10" font-family="Fira Code">CALL func</text>
                    <text x="40" y="115" fill="#ff6b35" font-size="10" font-family="Fira Code">‚Üê returns here</text>
                    <text x="40" y="135" fill="#a0a0a0" font-size="10" font-family="Fira Code">...</text>
                    
                    <!-- Arrow to func -->
                    <path d="M200 95 Q 260 60 300 70" stroke="#00ff88" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                    <text x="250" y="55" fill="#00ff88" font-size="10">CALL</text>
                    
                    <!-- func function -->
                    <rect x="300" y="20" width="180" height="160" rx="10" fill="#1a2235" stroke="#00ff88" stroke-width="2"/>
                    <text x="390" y="45" text-anchor="middle" fill="#00ff88" font-size="12" font-weight="bold">func()</text>
                    
                    <text x="320" y="75" fill="#a0a0a0" font-size="10" font-family="Fira Code">push ebp</text>
                    <text x="320" y="95" fill="#a0a0a0" font-size="10" font-family="Fira Code">mov ebp, esp</text>
                    <text x="320" y="115" fill="#a0a0a0" font-size="10" font-family="Fira Code">; code...</text>
                    <text x="320" y="135" fill="#a0a0a0" font-size="10" font-family="Fira Code">pop ebp</text>
                    <text x="320" y="155" fill="#ff6b35" font-size="10" font-family="Fira Code">RET</text>
                    
                    <!-- Arrow back -->
                    <path d="M300 155 Q 260 180 200 115" stroke="#ff6b35" stroke-width="2" fill="none" marker-end="url(#arrowhead2)"/>
                    <text x="250" y="175" fill="#ff6b35" font-size="10">RET</text>
                    
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#00ff88"/>
                        </marker>
                        <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ff6b35"/>
                        </marker>
                    </defs>
                </svg>
            </div>

            <h2>üéØ Identifying Patterns in RE</h2>

            <h3>üìå Common Patterns</h3>

            <div class="code-block">
                <div class="code-label">if-else pattern:</div>
                <pre>CMP ...             ; Compare
Jxx else_label      ; Conditional jump
; if code
JMP end_label       ; Skip else
else_label:
; else code
end_label:
; Pattern: CMP -> conditional jump -> JMP (to skip else)</pre>
            </div>

            <div class="code-block">
                <div class="code-label">while loop pattern:</div>
                <pre>loop_start:
CMP ...             ; Check condition
Jxx loop_end        ; Exit if condition false
; loop body
JMP loop_start      ; Jump back to start
loop_end:
; Pattern: CMP at start -> exit jump -> JMP back to start</pre>
            </div>

            <div class="code-block">
                <div class="code-label">for loop pattern:</div>
                <pre>; init (i=0)
loop_start:
CMP ECX, limit      ; Check condition
Jxx loop_end        ; Exit if done
; loop body
INC ECX             ; i++ (or DEC)
JMP loop_start      ; Jump back
loop_end:
; Pattern: init -> CMP -> body -> INC/DEC -> JMP back</pre>
            </div>

            <h2>üìã Chapter Summary</h2>
            
            <ul>
                <li><strong>JMP</strong> - unconditional jump</li>
                <li><strong>CMP</strong> - comparison (updates flags)</li>
                <li><strong>TEST</strong> - check if 0</li>
                <li><strong>Jxx</strong> - conditional jumps (JE, JNE, JG, JL...)</li>
                <li><strong>LOOP</strong> - loop with ECX</li>
                <li><strong>CALL</strong> - function call</li>
                <li><strong>RET</strong> - return from function</li>
                <li>Signed: JG, JGE, JL, JLE | Unsigned: JA, JAE, JB, JBE</li>
            </ul>

            <div class="nav-buttons">
                <a href="chapter5.html" class="nav-btn">‚Üê Chapter 5: Assembly Basics</a>
                <a href="chapter7.html" class="nav-btn">Chapter 7: PE Format ‚Üí</a>
            </div>
        </div>
    </div>
</body>
</html>
