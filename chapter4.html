<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Memory Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131a2b;
            --bg-card: #1a2235;
            --accent-primary: #00ff88;
            --accent-secondary: #00b4d8;
            --accent-warning: #ff6b35;
            --accent-purple: #a855f7;
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0a0;
            --border-color: #2a3548;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.9; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        nav { background: var(--bg-secondary); padding: 1rem 2rem; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 100; }
        nav a { color: var(--accent-primary); text-decoration: none; }
        .chapter-header { background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%); padding: 4rem 2rem; text-align: center; border-bottom: 1px solid var(--border-color); }
        .chapter-number { display: inline-block; background: linear-gradient(135deg, #00ff88 0%, #00b4d8 100%); color: var(--bg-primary); padding: 0.5rem 1.5rem; border-radius: 30px; font-weight: 700; margin-bottom: 1rem; }
        h1 { font-size: 2.5rem; margin-bottom: 1rem; background: linear-gradient(135deg, #00ff88 0%, #00b4d8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { color: var(--text-secondary); font-size: 1.1rem; }
        .content { padding: 3rem 0; }
        h2 { font-size: 1.8rem; color: var(--accent-primary); margin: 3rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border-color); }
        h3 { font-size: 1.3rem; color: var(--accent-secondary); margin: 2rem 0 1rem; }
        p { margin-bottom: 1.5rem; }
        .definition { background: var(--bg-card); border-left: 4px solid var(--accent-primary); padding: 1.5rem; border-radius: 0 10px 10px 0; margin: 1.5rem 0; }
        .definition-title { color: var(--accent-primary); font-weight: 700; font-size: 1.1rem; margin-bottom: 0.5rem; }
        .info-box { background: rgba(0, 180, 216, 0.1); border: 1px solid var(--accent-secondary); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
        .info-box-title { color: var(--accent-secondary); font-weight: 700; margin-bottom: 0.5rem; }
        .warning-box { background: rgba(255, 107, 53, 0.1); border: 1px solid var(--accent-warning); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
        .warning-box-title { color: var(--accent-warning); font-weight: 700; margin-bottom: 0.5rem; }
        ul, ol { margin: 1rem 0 1.5rem 1.5rem; }
        li { margin-bottom: 0.8rem; }
        code { font-family: 'Fira Code', monospace; background: var(--bg-card); padding: 0.2rem 0.5rem; border-radius: 4px; color: var(--accent-primary); font-size: 0.9rem; }
        pre { font-family: 'Fira Code', monospace; background: var(--bg-card); padding: 1.5rem; border-radius: 10px; overflow-x: auto; margin: 0; border: 1px solid var(--border-color); }
        .code-block { margin: 1.5rem 0; }
        .code-label { color: var(--accent-secondary); font-weight: 700; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .diagram { background: var(--bg-card); border-radius: 15px; padding: 2rem; margin: 2rem 0; text-align: center; border: 1px solid var(--border-color); }
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; background: var(--bg-card); border-radius: 10px; overflow: hidden; }
        th, td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color); }
        th { background: var(--bg-secondary); color: var(--accent-primary); font-weight: 600; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color); }
        .nav-btn { background: var(--bg-card); color: var(--text-primary); padding: 1rem 2rem; border-radius: 10px; text-decoration: none; border: 1px solid var(--border-color); transition: all 0.3s; }
        .nav-btn:hover { border-color: var(--accent-primary); transform: translateY(-3px); }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">â† Back to Main Menu</a>
    </nav>

    <header class="chapter-header">
        <div class="chapter-number">Chapter 4</div>
        <h1>Memory Management</h1>
        <p class="subtitle">Stack, Heap, and how programs store data</p>
    </header>

    <div class="container">
        <div class="content">
            
            <h2>ğŸ—ºï¸ Process Memory Layout</h2>

            <p>
                When a program runs, the operating system gives it its own virtual memory space.
                This space is divided into regions with different purposes:
            </p>

            <div class="diagram">
                <svg viewBox="0 0 400 450" xmlns="http://www.w3.org/2000/svg">
                    <rect x="100" y="20" width="200" height="50" rx="5" fill="#1a2235" stroke="#ff6b35" stroke-width="2"/>
                    <text x="200" y="50" text-anchor="middle" fill="#ff6b35" font-size="14" font-weight="bold">Stack â†“</text>
                    <text x="320" y="50" text-anchor="start" fill="#a0a0a0" font-size="10">High addresses</text>
                    
                    <text x="200" y="90" text-anchor="middle" fill="#a0a0a0" font-size="10">â†“ Grows downward</text>
                    
                    <rect x="100" y="100" width="200" height="40" rx="5" fill="#0a0e17" stroke="#2a3548" stroke-width="1" stroke-dasharray="5,5"/>
                    <text x="200" y="125" text-anchor="middle" fill="#a0a0a0" font-size="12">Free space</text>
                    
                    <text x="200" y="165" text-anchor="middle" fill="#a0a0a0" font-size="10">â†‘ Grows upward</text>
                    
                    <rect x="100" y="175" width="200" height="50" rx="5" fill="#1a2235" stroke="#a855f7" stroke-width="2"/>
                    <text x="200" y="205" text-anchor="middle" fill="#a855f7" font-size="14" font-weight="bold">Heap â†‘</text>
                    
                    <rect x="100" y="245" width="200" height="50" rx="5" fill="#1a2235" stroke="#00b4d8" stroke-width="2"/>
                    <text x="200" y="275" text-anchor="middle" fill="#00b4d8" font-size="14" font-weight="bold">.bss (uninitialized)</text>
                    
                    <rect x="100" y="305" width="200" height="50" rx="5" fill="#1a2235" stroke="#00b4d8" stroke-width="2"/>
                    <text x="200" y="335" text-anchor="middle" fill="#00b4d8" font-size="14" font-weight="bold">.data (data)</text>
                    
                    <rect x="100" y="365" width="200" height="50" rx="5" fill="#1a2235" stroke="#00ff88" stroke-width="2"/>
                    <text x="200" y="395" text-anchor="middle" fill="#00ff88" font-size="14" font-weight="bold">.text (code)</text>
                    <text x="320" y="395" text-anchor="start" fill="#a0a0a0" font-size="10">Low addresses</text>
                </svg>
            </div>

            <h3>Main Regions</h3>

            <table>
                <tr>
                    <th>Region</th>
                    <th>Content</th>
                    <th>Permissions</th>
                </tr>
                <tr>
                    <td><code>.text</code></td>
                    <td>Program code (Assembly instructions)</td>
                    <td>Read + Execute</td>
                </tr>
                <tr>
                    <td><code>.data</code></td>
                    <td>Initialized global variables</td>
                    <td>Read + Write</td>
                </tr>
                <tr>
                    <td><code>.bss</code></td>
                    <td>Uninitialized global variables</td>
                    <td>Read + Write</td>
                </tr>
                <tr>
                    <td><strong>Heap</strong></td>
                    <td>Dynamic allocations (malloc, new)</td>
                    <td>Read + Write</td>
                </tr>
                <tr>
                    <td><strong>Stack</strong></td>
                    <td>Local variables, return addresses</td>
                    <td>Read + Write</td>
                </tr>
            </table>

            <h2>ğŸ“š The Stack</h2>

            <div class="definition">
                <div class="definition-title">ğŸ“– Definition: Stack</div>
                <p>A LIFO (Last In, First Out) data structure - the last item that enters is the first to leave.<br>
                Used to store local variables, function parameters, and return addresses.</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">â“ What "enters" the Stack?</div>
                <p>What actually "enters" the Stack? <strong>Data</strong> - values, numbers, addresses:</p>
                <table style="margin: 1rem 0; font-size: 0.9rem;">
                    <tr>
                        <th>What enters</th>
                        <th>Example</th>
                        <th>Explanation</th>
                    </tr>
                    <tr>
                        <td>Register value</td>
                        <td><code>PUSH EAX</code></td>
                        <td>The value inside EAX enters the Stack</td>
                    </tr>
                    <tr>
                        <td>Constant number</td>
                        <td><code>PUSH 5</code></td>
                        <td>The number 5 enters the Stack</td>
                    </tr>
                    <tr>
                        <td>Return address</td>
                        <td><code>CALL func</code></td>
                        <td>Address of next instruction enters</td>
                    </tr>
                </table>
                <p style="margin-bottom: 0;">
                    <strong>In short:</strong> "enters" = the value PUSH stores on Stack. "exits" = the value POP retrieves.
                </p>
            </div>

            <h3>ğŸ¯ Two Important Concepts - Don't Confuse Them!</h3>

            <table>
                <tr>
                    <th>Concept</th>
                    <th>Meaning</th>
                </tr>
                <tr>
                    <td><strong>LIFO</strong></td>
                    <td>Order of insertion and removal: last in = first out</td>
                </tr>
                <tr>
                    <td><strong>Grows Downward</strong></td>
                    <td>Direction of addresses: when adding data, the address number decreases</td>
                </tr>
            </table>

            <div class="info-box">
                <div class="info-box-title">ğŸ’¡ Analogy: Stack of Plates</div>
                <p>Imagine a stack of plates:</p>
                <pre style="background: transparent; padding: 0; border: none; margin: 0;">
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Plate 3 â”‚  â† Last in, First out!
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Plate 2 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Plate 1 â”‚  â† First in, Last out
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </pre>
                <p style="margin-bottom: 0; margin-top: 1rem;">
                    The last plate you placed is the first one you'll remove. That's LIFO.
                </p>
            </div>

            <h3>ğŸ“ What "Grows Downward" Means</h3>
            
            <p>
                In memory, high addresses are "at the top" and low addresses are "at the bottom".
                When you PUSH, ESP's address <strong>decreases</strong> (smaller number):
            </p>

            <div class="info-box">
                <div class="info-box-title">ğŸ’¡ Example: PUSH Operation</div>
                <pre style="background: transparent; padding: 0; border: none; margin: 0;">
High addresses (top)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 0xFFFF0010
â”‚       empty         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 0xFFFF000C
â”‚       empty         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 0xFFFF0008  â† ESP was here BEFORE push
â”‚     OLD DATA        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 0xFFFF0004  â† ESP is here AFTER push
â”‚     NEW VALUE       â”‚  (the pushed value)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Low addresses (bottom)

PUSH = Store value + ESP goes DOWN (address decreases)
POP  = Retrieve value + ESP goes UP (address increases)
                </pre>
            </div>

            <div class="warning-box">
                <div class="warning-box-title">âš ï¸ Why is it still LIFO?</div>
                <p>
                    ESP always points to the LAST item that was pushed.<br>
                    When you POP, you get that last item first.<br>
                    <strong>The direction of addresses doesn't change the order of operations!</strong>
                </p>
            </div>

            <div class="definition">
                <div class="definition-title">ğŸ“– Definition: ESP / RSP</div>
                <p>Stack Pointer - a register that always points to the top of the Stack (the last item that entered).</p>
            </div>

            <div class="definition">
                <div class="definition-title">ğŸ“– Definition: EBP / RBP</div>
                <p>Base Pointer - a register that points to the base of the current Stack Frame. Used to access parameters and local variables.</p>
            </div>

            <h3>Stack Operations</h3>

            <div class="code-block">
                <div class="code-label">Assembly:</div>
                <pre>PUSH EAX    ; Store EAX on Stack, ESP decreases by 4
POP EBX     ; Load value from Stack into EBX, ESP increases by 4</pre>
            </div>

            <div class="diagram">
                <svg viewBox="0 0 500 250" xmlns="http://www.w3.org/2000/svg">
                    <text x="100" y="20" text-anchor="middle" fill="#a0a0a0" font-size="12">Before PUSH</text>
                    
                    <rect x="30" y="30" width="140" height="30" fill="#1a2235" stroke="#2a3548" stroke-width="1"/>
                    <text x="100" y="50" text-anchor="middle" fill="#a0a0a0" font-size="10" font-family="Fira Code">0xFFFF0010</text>
                    
                    <rect x="30" y="60" width="140" height="30" fill="#1a2235" stroke="#2a3548" stroke-width="1"/>
                    <text x="100" y="80" text-anchor="middle" fill="#a0a0a0" font-size="10" font-family="Fira Code">0xFFFF000C</text>
                    
                    <rect x="30" y="90" width="140" height="30" fill="#1a2235" stroke="#00ff88" stroke-width="2"/>
                    <text x="100" y="110" text-anchor="middle" fill="#00ff88" font-size="10" font-family="Fira Code">0xFFFF0008 â† ESP</text>
                    
                    <text x="250" y="100" text-anchor="middle" fill="#00b4d8" font-size="20">â†’</text>
                    <text x="250" y="120" text-anchor="middle" fill="#a0a0a0" font-size="10">PUSH EAX</text>
                    
                    <text x="400" y="20" text-anchor="middle" fill="#a0a0a0" font-size="12">After PUSH</text>
                    
                    <rect x="330" y="30" width="140" height="30" fill="#1a2235" stroke="#2a3548" stroke-width="1"/>
                    <text x="400" y="50" text-anchor="middle" fill="#a0a0a0" font-size="10" font-family="Fira Code">0xFFFF0010</text>
                    
                    <rect x="330" y="60" width="140" height="30" fill="#1a2235" stroke="#2a3548" stroke-width="1"/>
                    <text x="400" y="80" text-anchor="middle" fill="#a0a0a0" font-size="10" font-family="Fira Code">0xFFFF000C</text>
                    
                    <rect x="330" y="90" width="140" height="30" fill="#1a2235" stroke="#2a3548" stroke-width="1"/>
                    <text x="400" y="110" text-anchor="middle" fill="#a0a0a0" font-size="10" font-family="Fira Code">0xFFFF0008</text>
                    
                    <rect x="330" y="120" width="140" height="30" fill="#ff6b35" stroke="#00ff88" stroke-width="2"/>
                    <text x="400" y="140" text-anchor="middle" fill="#1a2235" font-size="10" font-family="Fira Code">0xFFFF0004 â† ESP</text>
                    
                    <text x="400" y="170" text-anchor="middle" fill="#ff6b35" font-size="10">(EAX value here)</text>
                </svg>
            </div>

            <h2>ğŸ”² Stack Frame</h2>

            <div class="definition">
                <div class="definition-title">ğŸ“– Definition: Stack Frame</div>
                <p>A region on the Stack that belongs to a specific function. Contains the local variables, parameters, and return address of that function.</p>
            </div>

            <p>When a function is called, a new Stack Frame is created:</p>

            <div class="code-block">
                <div class="code-label">Prologue (Function Start):</div>
                <pre>push ebp        ; Save old EBP on Stack
mov ebp, esp    ; EBP now points to new Frame base  
sub esp, 0x10   ; Allocate 16 bytes for local variables</pre>
            </div>

            <div class="code-block">
                <div class="code-label">Epilogue (Function End):</div>
                <pre>mov esp, ebp    ; Restore ESP to original state
pop ebp         ; Restore old EBP
ret             ; Return to caller function</pre>
            </div>

            <div class="diagram">
                <svg viewBox="0 0 400 320" xmlns="http://www.w3.org/2000/svg">
                    <text x="200" y="20" text-anchor="middle" fill="#00ff88" font-size="14" font-weight="bold">Stack Frame</text>
                    
                    <text x="50" y="50" text-anchor="end" fill="#a0a0a0" font-size="10">High addresses</text>
                    
                    <rect x="100" y="55" width="200" height="35" fill="#1a2235" stroke="#a855f7" stroke-width="2"/>
                    <text x="200" y="78" text-anchor="middle" fill="#a855f7" font-size="12">Parameter 2</text>
                    <text x="320" y="78" text-anchor="start" fill="#a0a0a0" font-size="9" font-family="Fira Code">[EBP+0xC]</text>
                    
                    <rect x="100" y="90" width="200" height="35" fill="#1a2235" stroke="#a855f7" stroke-width="2"/>
                    <text x="200" y="113" text-anchor="middle" fill="#a855f7" font-size="12">Parameter 1</text>
                    <text x="320" y="113" text-anchor="start" fill="#a0a0a0" font-size="9" font-family="Fira Code">[EBP+0x8]</text>
                    
                    <rect x="100" y="125" width="200" height="35" fill="#1a2235" stroke="#ff6b35" stroke-width="2"/>
                    <text x="200" y="148" text-anchor="middle" fill="#ff6b35" font-size="12">Return Address</text>
                    <text x="320" y="148" text-anchor="start" fill="#a0a0a0" font-size="9" font-family="Fira Code">[EBP+0x4]</text>
                    
                    <rect x="100" y="160" width="200" height="35" fill="#1a2235" stroke="#00b4d8" stroke-width="2"/>
                    <text x="200" y="183" text-anchor="middle" fill="#00b4d8" font-size="12">Saved EBP</text>
                    <text x="320" y="183" text-anchor="start" fill="#00ff88" font-size="9" font-family="Fira Code">â† EBP</text>
                    
                    <rect x="100" y="195" width="200" height="35" fill="#1a2235" stroke="#00ff88" stroke-width="2"/>
                    <text x="200" y="218" text-anchor="middle" fill="#00ff88" font-size="12">Local Variable 1</text>
                    <text x="320" y="218" text-anchor="start" fill="#a0a0a0" font-size="9" font-family="Fira Code">[EBP-0x4]</text>
                    
                    <rect x="100" y="230" width="200" height="35" fill="#1a2235" stroke="#00ff88" stroke-width="2"/>
                    <text x="200" y="253" text-anchor="middle" fill="#00ff88" font-size="12">Local Variable 2</text>
                    <text x="320" y="253" text-anchor="start" fill="#00ff88" font-size="9" font-family="Fira Code">â† ESP</text>
                    
                    <text x="50" y="285" text-anchor="end" fill="#a0a0a0" font-size="10">Low addresses</text>
                </svg>
            </div>

            <h3>ğŸ”‘ Important: Variable Names Don't Exist in Assembly!</h3>
            
            <p>
                In C code, there are variable names like <code>a</code> and <code>b</code>.
                But in Assembly, there are only <strong>memory addresses</strong> - the names disappear after compilation!
            </p>

            <div class="info-box">
                <div class="info-box-title">ğŸ’¡ Example: C to Assembly</div>
                <pre style="background: transparent; padding: 0; border: none; margin: 0;">
C code:                        Assembly:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ int a = 5;      â”‚     â†’      â”‚ mov dword [ebp-4], 5    â”‚
â”‚ int b = 10;     â”‚     â†’      â”‚ mov dword [ebp-8], 10   â”‚
â”‚ a = a + b;      â”‚     â†’      â”‚ mov eax, [ebp-4]        â”‚
â”‚                 â”‚            â”‚ add eax, [ebp-8]        â”‚
â”‚                 â”‚            â”‚ mov [ebp-4], eax        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Named variables                Just memory addresses!
                </pre>
            </div>

            <table>
                <tr>
                    <th>C Variable</th>
                    <th>Assembly Location</th>
                    <th>Explanation</th>
                </tr>
                <tr>
                    <td><code>a</code></td>
                    <td><code>[EBP-4]</code></td>
                    <td>First local variable (4 bytes from EBP)</td>
                </tr>
                <tr>
                    <td><code>b</code></td>
                    <td><code>[EBP-8]</code></td>
                    <td>Second local variable (8 bytes from EBP)</td>
                </tr>
                <tr>
                    <td><code>param1</code></td>
                    <td><code>[EBP+8]</code></td>
                    <td>First parameter (above EBP)</td>
                </tr>
            </table>

            <div class="warning-box">
                <div class="warning-box-title">âš ï¸ This is key for RE!</div>
                <p style="margin-bottom: 0;">
                    When you see <code>mov eax, [ebp-4]</code>, think:<br>
                    <strong>"Loading some local variable into EAX"</strong><br><br>
                    Your job in RE is to figure out what that variable represents based on how it's used!
                </p>
            </div>

            <h2>ğŸ”ï¸ The Heap</h2>

            <div class="definition">
                <div class="definition-title">ğŸ“– Definition: Heap</div>
                <p>A memory region for dynamic allocations - when you don't know ahead of time how much memory you need.<br>
                In C: <code>malloc()</code>, <code>free()</code><br>
                In C++: <code>new</code>, <code>delete</code></p>
            </div>

            <table>
                <tr>
                    <th>Stack</th>
                    <th>Heap</th>
                </tr>
                <tr>
                    <td>Automatic allocation</td>
                    <td>Manual allocation</td>
                </tr>
                <tr>
                    <td>Automatically freed at function end</td>
                    <td>Must be manually freed!</td>
                </tr>
                <tr>
                    <td>Fast</td>
                    <td>Slower</td>
                </tr>
                <tr>
                    <td>Limited size</td>
                    <td>Larger size available</td>
                </tr>
                <tr>
                    <td>Grows downward (addresses decrease)</td>
                    <td>Grows upward (addresses increase)</td>
                </tr>
            </table>

            <h2>ğŸŒ Virtual Memory</h2>

            <div class="definition">
                <div class="definition-title">ğŸ“– Definition: Virtual Memory</div>
                <p>An abstract numbering system that the OS creates for each process. Each program "thinks" it has a huge memory space to itself, but the OS maps virtual addresses to real locations.</p>
            </div>

            <h3>ğŸ”‘ The Difference Between Virtual and Physical</h3>

            <table>
                <tr>
                    <th>Term</th>
                    <th>What it is</th>
                </tr>
                <tr>
                    <td><strong>RAM</strong></td>
                    <td>Physical Memory - the actual hardware (memory chips in the computer)</td>
                </tr>
                <tr>
                    <td><strong>Virtual Memory</strong></td>
                    <td>Abstraction - a numbering system the OS manages (doesn't "sit" anywhere)</td>
                </tr>
                <tr>
                    <td><strong>Virtual Address</strong></td>
                    <td>The address the program sees (e.g., <code>0x00401000</code>)</td>
                </tr>
                <tr>
                    <td><strong>Physical Address</strong></td>
                    <td>The actual address in RAM</td>
                </tr>
            </table>

            <h3>ğŸ“ Where Does Data Actually Sit?</h3>

            <div class="diagram">
                <svg viewBox="0 0 500 280" xmlns="http://www.w3.org/2000/svg">
                    <rect x="20" y="20" width="130" height="70" rx="5" fill="#1a2235" stroke="#00ff88" stroke-width="2"/>
                    <text x="85" y="45" text-anchor="middle" fill="#00ff88" font-size="11" font-weight="bold">Process A</text>
                    <text x="85" y="65" text-anchor="middle" fill="#a0a0a0" font-size="9" font-family="Fira Code">0x00401000</text>
                    
                    <rect x="20" y="100" width="130" height="70" rx="5" fill="#1a2235" stroke="#00b4d8" stroke-width="2"/>
                    <text x="85" y="125" text-anchor="middle" fill="#00b4d8" font-size="11" font-weight="bold">Process B</text>
                    <text x="85" y="145" text-anchor="middle" fill="#a0a0a0" font-size="9" font-family="Fira Code">0x00401000</text>
                    
                    <text x="85" y="195" text-anchor="middle" fill="#a0a0a0" font-size="10">Same virtual address!</text>
                    
                    <path d="M155 55 L200 55 L200 100 L245 100" stroke="#00ff88" stroke-width="2" fill="none" marker-end="url(#arrowG)"/>
                    <path d="M155 135 L200 135 L200 180 L245 180" stroke="#00b4d8" stroke-width="2" fill="none" marker-end="url(#arrowB)"/>
                    
                    <rect x="250" y="80" width="80" height="120" rx="5" fill="#1a2235" stroke="#a855f7" stroke-width="2"/>
                    <text x="290" y="105" text-anchor="middle" fill="#a855f7" font-size="10" font-weight="bold">Page</text>
                    <text x="290" y="120" text-anchor="middle" fill="#a855f7" font-size="10" font-weight="bold">Table</text>
                    <text x="290" y="145" text-anchor="middle" fill="#a0a0a0" font-size="8">(OS manages)</text>
                    <text x="290" y="175" text-anchor="middle" fill="#a0a0a0" font-size="8">Virtualâ†’Physical</text>
                    
                    <path d="M335 120 L370 120" stroke="#ff6b35" stroke-width="2" fill="none" marker-end="url(#arrowO)"/>
                    
                    <rect x="375" y="30" width="110" height="200" rx="5" fill="#1a2235" stroke="#ff6b35" stroke-width="2"/>
                    <text x="430" y="55" text-anchor="middle" fill="#ff6b35" font-size="12" font-weight="bold">Physical RAM</text>
                    <text x="430" y="75" text-anchor="middle" fill="#a0a0a0" font-size="8">(actual hardware)</text>
                    
                    <rect x="385" y="95" width="90" height="25" rx="3" fill="#00ff88" fill-opacity="0.2" stroke="#00ff88" stroke-width="1"/>
                    <text x="430" y="112" text-anchor="middle" fill="#00ff88" font-size="8" font-family="Fira Code">0x12340000</text>
                    
                    <rect x="385" y="130" width="90" height="25" rx="3" fill="#00b4d8" fill-opacity="0.2" stroke="#00b4d8" stroke-width="1"/>
                    <text x="430" y="147" text-anchor="middle" fill="#00b4d8" font-size="8" font-family="Fira Code">0x56780000</text>
                    
                    <text x="430" y="185" text-anchor="middle" fill="#a0a0a0" font-size="9">Different physical</text>
                    <text x="430" y="200" text-anchor="middle" fill="#a0a0a0" font-size="9">addresses!</text>
                    
                    <text x="85" y="260" text-anchor="middle" fill="#a0a0a0" font-size="9">Virtual Addresses</text>
                    <text x="290" y="260" text-anchor="middle" fill="#a0a0a0" font-size="9">Translation</text>
                    <text x="430" y="260" text-anchor="middle" fill="#a0a0a0" font-size="9">Physical Storage</text>
                    
                    <defs>
                        <marker id="arrowG" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00ff88"/>
                        </marker>
                        <marker id="arrowB" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00b4d8"/>
                        </marker>
                        <marker id="arrowO" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#ff6b35"/>
                        </marker>
                    </defs>
                </svg>
            </div>

            <div class="info-box">
                <div class="info-box-title">ğŸ’¡ Where does data actually sit?</div>
                <pre style="background: transparent; padding: 0; border: none; margin: 0;">
Program uses Virtual Address (e.g., 0x00401000)
                    â†“
         CPU + Page Table translate
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Option 1: RAM            â”‚  â† Fast! (physical memory chips)
        â”‚  Option 2: Disk           â”‚  â† Slow! (pagefile.sys / swap)
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </pre>
                <p style="margin-bottom: 0; margin-top: 1rem;">
                    <strong>Virtual Memory doesn't "sit" anywhere</strong> - it's just a numbering system.<br>
                    The actual data sits in RAM or on disk, and the OS decides where.
                </p>
            </div>

            <p>Advantages:</p>
            <ul>
                <li><strong>Isolation:</strong> One process can't access another's memory</li>
                <li><strong>Simplicity:</strong> Each process "thinks" it has all the memory</li>
                <li><strong>Protection:</strong> Different regions with different permissions (R/W/X)</li>
            </ul>

            <div class="info-box">
                <div class="info-box-title">ğŸ’¡ For Reverse Engineering</div>
                <p style="margin-bottom: 0;">
                    <strong>In RE, you always see Virtual Addresses.</strong><br>
                    You don't need to know the physical addresses - the OS handles the translation automatically.
                </p>
            </div>

            <h2>ğŸ“‹ Chapter Summary</h2>
            
            <ul>
                <li><strong>Stack</strong> - local variables, grows downward, LIFO</li>
                <li><strong>Heap</strong> - dynamic allocations, grows upward</li>
                <li><strong>ESP</strong> - points to top of Stack</li>
                <li><strong>EBP</strong> - points to base of Stack Frame</li>
                <li><strong>Stack Frame</strong> - function's region (parameters + return address + variables)</li>
                <li><strong>Virtual Memory</strong> - each process gets its own address space</li>
            </ul>

            <div class="nav-buttons">
                <a href="chapter3.html" class="nav-btn">â† Chapter 3: Architecture</a>
                <a href="chapter5.html" class="nav-btn">Chapter 5: Assembly Basics â†’</a>
            </div>
        </div>
    </div>
</body>
</html>
