<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 5: Advanced Debugging</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131a2b;
            --bg-card: #1a2235;
            --accent-primary: #00ff88;
            --accent-secondary: #00b4d8;
            --accent-warning: #ff6b35;
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0a0;
            --border-color: #2a3548;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.9; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        nav { background: var(--bg-secondary); padding: 1rem 2rem; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 100; }
        nav a { color: var(--accent-primary); text-decoration: none; }
        .chapter-header { background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); padding: 4rem 2rem; text-align: center; }
        .chapter-number { display: inline-block; background: rgba(0,0,0,0.3); color: white; padding: 0.5rem 1.5rem; border-radius: 30px; font-weight: 700; margin-bottom: 1rem; }
        h1 { font-size: 2.5rem; margin-bottom: 1rem; color: white; }
        .subtitle { color: rgba(255,255,255,0.9); font-size: 1.1rem; }
        .content { padding: 3rem 0; }
        h2 { font-size: 1.8rem; color: var(--accent-warning); margin: 3rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border-color); }
        h3 { font-size: 1.3rem; color: var(--accent-secondary); margin: 2rem 0 1rem; }
        p { margin-bottom: 1.5rem; }
        .task-box { background: rgba(255, 107, 53, 0.1); border: 1px solid var(--accent-warning); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
        .task-title { color: var(--accent-warning); font-weight: 700; margin-bottom: 0.5rem; font-size: 1.1rem; }
        .info-box { background: rgba(0, 180, 216, 0.1); border: 1px solid var(--accent-secondary); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
        .info-box-title { color: var(--accent-secondary); font-weight: 700; margin-bottom: 0.5rem; }
        ul, ol { margin: 1rem 0 1.5rem 1.5rem; }
        li { margin-bottom: 0.8rem; }
        code { font-family: 'Fira Code', monospace; background: var(--bg-card); padding: 0.2rem 0.5rem; border-radius: 4px; color: var(--accent-primary); font-size: 0.9rem; }
        pre { font-family: 'Fira Code', monospace; background: var(--bg-card); padding: 1.5rem; border-radius: 10px; overflow-x: auto; margin: 1.5rem 0; border: 1px solid var(--border-color); direction: ltr; text-align: left; line-height: 1.6; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color); }
        .nav-btn { background: var(--bg-card); color: var(--text-primary); padding: 1rem 2rem; border-radius: 10px; text-decoration: none; border: 1px solid var(--border-color); transition: all 0.3s; }
        .nav-btn:hover { border-color: var(--accent-warning); transform: translateY(-3px); }
        .checklist { list-style: none; margin-left: 0; }
        .checklist li { padding: 0.5rem 0; padding-left: 2rem; position: relative; }
        .checklist li::before { content: '‚òê'; position: absolute; left: 0; color: var(--accent-warning); }
        .success-box { background: rgba(0, 255, 136, 0.1); border: 2px solid var(--accent-primary); border-radius: 10px; padding: 2rem; margin: 2rem 0; text-align: center; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">‚Üê Back to Main Menu</a>
    </nav>

    <header class="chapter-header">
        <div class="chapter-number">üîß Lab 5</div>
        <h1>Advanced Debugging</h1>
        <p class="subtitle">Execution tracing, memory modification, and Patching</p>
    </header>

    <div class="container">
        <div class="content">
            
            <h2>üéØ Lab Objectives</h2>
            <ul>
                <li>Advanced use of breakpoints</li>
                <li>Modifying values at runtime</li>
                <li>Patching - permanent code modification</li>
                <li>Bypassing security checks</li>
            </ul>

            <h2>üî¥ Part 1: Types of Breakpoints</h2>

            <div class="task-box">
                <div class="task-title">Task 1.1 - Software Breakpoint</div>
                <ol>
                    <li>Open a program in x64dbg</li>
                    <li>Find the Entry Point (Ctrl+E)</li>
                    <li>Set a BP on the first line (F2)</li>
                    <li>Run (F9) - the program will stop at the BP</li>
                    <li>Check that the first byte of the instruction was replaced with <code>0xCC</code> (INT 3)</li>
                </ol>
            </div>

            <div class="task-box">
                <div class="task-title">Task 1.2 - Hardware Breakpoint</div>
                <p>Hardware BP doesn't modify the code - more "stealthy":</p>
                <ol>
                    <li>Right-click on an instruction ‚Üí Breakpoint ‚Üí Hardware ‚Üí Execute</li>
                    <li>Run and verify it stops</li>
                    <li>Advantage: anti-debug programs are less likely to detect it</li>
                </ol>
            </div>

            <div class="task-box">
                <div class="task-title">Task 1.3 - Memory Breakpoint</div>
                <p>Stop on memory access:</p>
                <ol>
                    <li>In the Dump window, find an interesting address</li>
                    <li>Right-click ‚Üí Breakpoint ‚Üí Memory, Access</li>
                    <li>Run - will stop when something reads/writes to that address</li>
                </ol>
            </div>

            <div class="task-box">
                <div class="task-title">Task 1.4 - Conditional Breakpoint</div>
                <p>Stop only when a condition is met:</p>
                <ol>
                    <li>Set a regular BP (F2)</li>
                    <li>Right-click on the BP ‚Üí Edit</li>
                    <li>Add condition: <code>eax == 5</code></li>
                    <li>Run - will stop only when EAX equals 5</li>
                </ol>
            </div>

            <h2>‚úèÔ∏è Part 2: Modifying Values at Runtime</h2>

            <div class="task-box">
                <div class="task-title">Task 2.1 - Modify Register</div>
                <ol>
                    <li>Stop on a CMP instruction</li>
                    <li>In the Registers window, double-click on EAX</li>
                    <li>Change the value</li>
                    <li>Continue (F8) and see how it affects the jump</li>
                </ol>
            </div>

            <div class="task-box">
                <div class="task-title">Task 2.2 - Modify Flags</div>
                <p>Changing the Zero Flag (ZF) to change a jump:</p>
                <ol>
                    <li>Stop after a CMP or TEST instruction</li>
                    <li>In the Registers window, find ZF</li>
                    <li>Double-click to toggle (0‚Üî1)</li>
                    <li>JE/JNE will now behave opposite!</li>
                </ol>
            </div>

            <div class="task-box">
                <div class="task-title">Task 2.3 - Modify Memory</div>
                <ol>
                    <li>In the Dump window, find the address you want to change</li>
                    <li>Double-click on a byte</li>
                    <li>Type a new value</li>
                    <li>Or: Right-click ‚Üí Binary ‚Üí Edit</li>
                </ol>
            </div>

            <h2>üîß Part 3: Patching</h2>

            <div class="info-box">
                <div class="info-box-title">üìù What is Patching?</div>
                <p>
                    Modifying bytes in the code to permanently change behavior.<br>
                    Common: flipping JE to JNE, or replacing with NOP.
                </p>
            </div>

            <h3>Important Opcodes Table</h3>
            <pre>
Instruction    Opcode     Notes
-----------    ------     -----
NOP            90         No Operation - does nothing
JMP short      EB XX      Short jump (127 bytes forward/backward)
JE short       74 XX      Jump if Equal
JNE short      75 XX      Jump if Not Equal
JMP near       E9 XX XX   Long jump (32-bit offset)
CALL           E8 XX XX   Call function
RET            C3         Return
            </pre>

            <div class="task-box">
                <div class="task-title">Task 3.1 - Flip JE to JNE</div>
                <ol>
                    <li>Find a JE instruction (74 XX)</li>
                    <li>Press Space on the instruction (or right-click ‚Üí Assemble)</li>
                    <li>Change to JNE</li>
                    <li>Or: manually change 74 ‚Üí 75</li>
                </ol>
            </div>

            <div class="task-box">
                <div class="task-title">Task 3.2 - NOP Out</div>
                <p>Replacing instructions with NOP (canceling):</p>
                <ol>
                    <li>Select the instruction(s) you want to cancel</li>
                    <li>Right-click ‚Üí Binary ‚Üí Fill with NOPs</li>
                    <li>Or: Ctrl+9</li>
                </ol>
            </div>

            <div class="task-box">
                <div class="task-title">Task 3.3 - Save Patch</div>
                <p>To save the changes to the file:</p>
                <ol>
                    <li>Right-click ‚Üí Patches (or Ctrl+P)</li>
                    <li>See the list of all changes</li>
                    <li>Patch File - saves to a new file</li>
                </ol>
            </div>

            <h2>üéØ Part 4: Summary Exercise</h2>

            <div class="task-box">
                <div class="task-title">Challenge: Bypass Password Check</div>
                <p>The following code checks a password. Find 3 ways to bypass:</p>
                <pre>
00401000: push ebp
00401001: mov ebp, esp
00401003: mov eax, [ebp+8]        ; password
00401006: push eax
00401007: call strcmp             ; compare with "secret"
0040100C: add esp, 8
0040100F: test eax, eax
00401011: jne 00401020            ; wrong password
00401013: push "Access Granted"
00401018: call printf
0040101D: jmp 0040102A
00401020: push "Wrong Password"   ; wrong password branch
00401025: call printf
0040102A: leave
0040102B: ret
                </pre>

                <p><strong>Method 1 - Modify Register:</strong></p>
                <ul class="checklist">
                    <li>Set BP on TEST</li>
                    <li>After TEST, change EAX to 0</li>
                </ul>

                <p><strong>Method 2 - Modify Flag:</strong></p>
                <ul class="checklist">
                    <li>Set BP after TEST</li>
                    <li>Change ZF to 1 (Zero)</li>
                </ul>

                <p><strong>Method 3 - Patch:</strong></p>
                <ul class="checklist">
                    <li>Change JNE to JE (75 ‚Üí 74)</li>
                    <li>Or: change to NOP NOP (75 0D ‚Üí 90 90)</li>
                </ul>
            </div>

            <h2>üõ°Ô∏è Part 5: Anti-Debug Basics</h2>

            <div class="info-box">
                <div class="info-box-title">üîç Common Anti-Debug Techniques</div>
                <p>Programs try to detect debuggers:</p>
                <ul>
                    <li><code>IsDebuggerPresent()</code> - direct check</li>
                    <li>Checking PEB.BeingDebugged flag</li>
                    <li>Timing measurement - breakpoints slow things down</li>
                    <li>Searching for breakpoints (0xCC)</li>
                </ul>
            </div>

            <div class="task-box">
                <div class="task-title">Task 5.1 - Bypass IsDebuggerPresent</div>
                <ol>
                    <li>Set BP: <code>bp kernel32.IsDebuggerPresent</code></li>
                    <li>Run - when stopped, do F9 or Ctrl+F9 until RET</li>
                    <li>Before RET, change EAX to 0 (not being debugged)</li>
                    <li>Or: Patch the function to always return 0</li>
                </ol>
            </div>

            <h2>‚úÖ Course Summary</h2>

            <div class="success-box">
                <h2 style="color: var(--accent-primary); margin-bottom: 1rem;">üéâ Congratulations!</h2>
                <p>You've completed both the theory and practical parts of the course!</p>
                <p style="margin-top: 1rem;">Now you have the foundation for:</p>
                <ul style="text-align: left; display: inline-block; margin-top: 1rem;">
                    <li>Reading and understanding Assembly code</li>
                    <li>Analyzing PE files</li>
                    <li>Using Ghidra and x64dbg</li>
                    <li>Solving simple Crackmes</li>
                </ul>
            </div>

            <h2>üìö Continue Learning</h2>

            <div class="info-box">
                <div class="info-box-title">üöÄ Next Steps</div>
                <ul>
                    <li><strong>Practice more Crackmes</strong> - crackmes.one</li>
                    <li><strong>Learn about Anti-Debug</strong> - advanced techniques</li>
                    <li><strong>Malware Analysis</strong> - analyzing malicious software (in VM!)</li>
                    <li><strong>CTF Challenges</strong> - RE competitions</li>
                    <li><strong>Read code</strong> - try to read and understand real programs</li>
                </ul>
            </div>

            <div class="info-box">
                <div class="info-box-title">üìñ Recommended Resources</div>
                <ul>
                    <li><strong>Books:</strong>
                        <ul>
                            <li>"Practical Malware Analysis" - the classic book</li>
                            <li>"Reversing: Secrets of Reverse Engineering"</li>
                            <li>"The IDA Pro Book"</li>
                        </ul>
                    </li>
                    <li><strong>Websites:</strong>
                        <ul>
                            <li>malware.news - malware analysis news</li>
                            <li>0xcc.re - RE blog</li>
                            <li>YouTube: OALabs, MalwareAnalysisForHedgehogs</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="nav-buttons">
                <a href="lab4.html" class="nav-btn">‚Üê Lab 4: PE Analysis</a>
                <a href="index.html" class="nav-btn">Back to Main Menu ‚Üí</a>
            </div>
        </div>
    </div>
</body>
</html>
